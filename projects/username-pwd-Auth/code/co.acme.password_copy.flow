Flow co.acme.password_copy
     Basepath ""
authService = Call io.jans.as.server.service.AuthenticationService#class 
// Create new cdiUtil object.
cdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean authService
// Empty Result Object
authResult = {}
// retry 3 times
Repeat 3 times max
     // loads login page for username and password input
     creds = RRF "login.ftlh" authResult
     // validate username and password
     authResult.success = Call cdiUtil authenticate creds.username creds.password
     // keep username in case user wants to retry
     authResult.uid = creds.username
     // check auth response
     When authResult.success is true
          authUrl = {}
          authUrl.url | exception = Call io.jans.duo.ClientDuoTest#duoValidate 
          Log "@info check" exception  authUrl
          callbackResult = " "
callbackResult = RFAC authUrl.url
callbackState = "  "
callbackState = Call io.jans.duo.ValidateDuoCallbackTest#validateCallback callbackResult
test = RRF "success.ftlh" callbackState
     Log "@info post when"
it_xmqvb = {success:false, error: "auth failed"}
Finish it_xmqvb